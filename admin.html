<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ADMIN DASHBOARD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --admin-primary: #00d2ff; --sidebar-width: 260px; }
        body { background: #06070a; color: white; font-family: 'Kanit', sans-serif; overflow-x: hidden; }
        
        /* Sidebar Style */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: rgba(255, 255, 255, 0.03);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 20px;
            z-index: 1000;
        }
        .nav-link {
            color: rgba(255, 255, 255, 0.6);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 5px;
            transition: 0.3s;
            cursor: pointer;
        }
        .nav-link:hover, .nav-link.active {
            background: rgba(0, 210, 255, 0.1);
            color: var(--admin-primary);
        }

        /* Content Area */
        .main-content { margin-left: var(--sidebar-width); padding: 40px; }
        .admin-card { 
            background: rgba(255,255,255,0.03); 
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 20px; 
            padding: 30px; 
            backdrop-filter: blur(10px);
        }
        
        .input-admin { 
            background: rgba(0,0,0,0.3); 
            border: 1px solid rgba(255,255,255,0.1); 
            color: white; 
            border-radius: 12px; 
            padding: 12px; 
            width: 100%; 
            transition: 0.3s;
        }
        .input-admin:focus { outline: none; border-color: var(--admin-primary); }
        
        .section-panel { display: none; }
        .section-panel.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #reset-config:hover {
            background-color: rgba(255, 255, 255, 0.2) !important; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏à‡∏≤‡∏á‡πÜ */
            color: #ffffff !important; /* ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° */
            border-color: #ffffff !important; /* ‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á */
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2) !important; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á‡∏ü‡∏∏‡πâ‡∏á‡∏£‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏° */
            transform: translateY(-2px); /* ‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
        }

        /* ‡πÅ‡∏ñ‡∏°: ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≠‡∏ô Hover ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
        #save-all-config:hover {
            background-color: var(--admin-primary) !important;
            border-color: var(--admin-primary) !important;
            box-shadow: 0 0 25px rgba(0, 210, 255, 0.4) !important;
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }

        .input-group-text {
            border-right: none !important;
        }
        .form-control {
            border-left: none !important;
        }
        .form-control:focus {
            border-color: var(--admin-primary) !important;
            background: rgba(0, 210, 255, 0.05) !important;
        }
        .input-group:focus-within .input-group-text {
            border-color: var(--admin-primary) !important;
            color: var(--admin-primary) !important;
        }
        .card {
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: rgba(0, 210, 255, 0.3) !important;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h4 class="mb-4 px-2"><i class="fa-solid fa-gauge-high text-primary me-2"></i> Admin</h4>
        <div class="nav-link active" onclick="showSection('general')">
            <i class="fa-solid fa-house-chimney me-2"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </div>
        <div class="nav-link" onclick="showSection('appearance')">
            <i class="fa-solid fa-palette me-2"></i> ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏µ & ‡∏ò‡∏µ‡∏°
        </div>
        <div class="nav-link" onclick="showSection('systems')">
            <i class="fa-solid fa-server me-2"></i> ‡∏£‡∏∞‡∏ö‡∏ö & Webhook
        </div>
        <div class="nav-link" onclick="showSection('users-manage')">
            <i class="fa-solid fa-users-gear me-2"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        </div>
        <div class="nav-link" onclick="showSection('payment-manage')">
            <i class="fa-solid fa-money-check-dollar me-2"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
        </div>
        <hr class="opacity-10">
        <a href="index.html" class="nav-link text-info">
            <i class="fa-solid fa-eye me-2"></i> ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        </a>
    </div>

    <div class="main-content">
        <div id="general" class="section-panel active">
            <h2 class="mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</h2>
            <div class="admin-card">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="small text-white-50 mb-2">
                            <i class="fa-solid fa-globe me-1"></i> ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (Site Name)
                        </label>
                        <input type="text" id="conf-sitename" class="input-admin" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="small text-white-50 mb-2">
                            <i class="fa-solid fa-wand-magic-sparkles me-1"></i> ‡∏Ñ‡∏≥‡πÇ‡∏õ‡∏£‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡∏¢‡πâ‡∏≥ (Accent Text)
                        </label>
                        <input type="text" id="conf-accenttext" class="input-admin" placeholder="‡πÄ‡∏ä‡πà‡∏ô GAMING SOLUTION">
                    </div>

                    <div class="col-md-12 mb-3">
                        <label class="small text-white-50 mb-2">
                            <i class="fa-brands fa-discord me-1"></i> ‡∏•‡∏¥‡∏á‡∏Å‡πå Discord
                        </label>
                        <input type="text" id="conf-discord-link" class="input-admin" placeholder="https://discord.gg/xxxx">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="small text-white-50 mb-2">
                            <i class="fa-solid fa-users me-1"></i> ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ 1 (Active Users)
                        </label>
                        <input type="text" id="conf-stat1-value" class="input-admin" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1,500">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="small text-white-50 mb-2">
                            <i class="fa-solid fa-cart-check me-1"></i> ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ 2 (Orders Completed)
                        </label>
                        <input type="text" id="conf-stat2-value" class="input-admin" placeholder="‡πÄ‡∏ä‡πà‡∏ô 25,000">
                    </div>

                    <div class="col-md-12 mb-3">
                        <label class="small text-white-50 mb-2">
                            <i class="fa-solid fa-quote-left me-1"></i> ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (Site Description)
                        </label>
                        <textarea id="conf-sitedesc" class="input-admin" rows="3" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div id="appearance" class="section-panel">
            <h2 class="mb-4">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏µ & ‡∏ò‡∏µ‡∏°</h2>
            <div class="admin-card">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <label class="small text-white-50 mb-2">‡∏™‡∏µ‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å (Buttons/Glow)</label>
                        <input type="color" id="conf-color" class="form-control form-control-color w-100" style="height:50px; background:none; border: 1px solid rgba(255,255,255,0.1);">
                    </div>
                    <div class="col-md-4 mb-4">
                        <label class="small text-white-50 mb-2">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (Background)</label>
                        <input type="color" id="conf-bg-color" class="form-control form-control-color w-100" style="height:50px; background:none; border: 1px solid rgba(255,255,255,0.1);">
                    </div>
                    <div class="col-md-4 mb-4">
                        <label class="small text-white-50 mb-2">‡∏™‡∏µ‡∏ü‡∏≠‡∏ô‡∏ï‡πå (Text Color)</label>
                        <input type="color" id="conf-text-color" class="form-control form-control-color w-100" style="height:50px; background:none; border: 1px solid rgba(255,255,255,0.1);">
                    </div>
                </div>
            </div>
        </div>

        <div id="systems" class="section-panel">
            <h2 class="mb-4">‡∏£‡∏∞‡∏ö‡∏ö & ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h2>
            <div class="card bg-dark border-secondary mb-4" style="background: rgba(255, 255, 255, 0.03) !important;">
            <div class="card-header border-secondary bg-transparent py-3">
                <h5 class="mb-0 text-white"><i class="fa-brands fa-discord me-2 text-primary"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Discord</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <label class="form-label text-white-50 small d-flex align-items-center">
                            <i class="fa-solid fa-gears me-2"></i> Webhook ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏∞‡∏ö‡∏ö & ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
                        </label>
                        <div class="input-group">
                            <span class="input-group-text bg-dark border-secondary text-white-50"><i class="fa-solid fa-link"></i></span>
                            <input type="text" id="conf-discord-webhook" class="form-control bg-dark text-white border-secondary shadow-none" 
                                placeholder="https://discord.com/api/webhooks/...">
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <label class="form-label text-white-50 small d-flex align-items-center">
                            <i class="fa-solid fa-users me-2"></i> Webhook ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà & ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </label>
                        <div class="input-group">
                            <span class="input-group-text bg-dark border-secondary text-white-50"><i class="fa-solid fa-shield-halved"></i></span>
                            <input type="text" id="conf-user-webhook" class="form-control bg-dark text-white border-secondary shadow-none" 
                                placeholder="https://discord.com/api/webhooks/...">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <div id="users-manage" class="section-panel" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="m-0"><i class="fa-solid fa-users-gear me-2"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
                <div class="search-box" style="width: 300px;">
                    <div class="input-group">
                        <span class="input-group-text bg-dark border-secondary text-white-50"><i class="fa-solid fa-magnifying-glass"></i></span>
                        <input type="text" id="user-search-input" class="form-control bg-dark border-secondary text-white" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•...">
                    </div>
                </div>
            </div>

            <div class="admin-card">
                <div class="table-responsive">
                    <table class="table table-dark table-hover border-secondary m-0">
                        <thead>
                            <tr>
                                <th class="py-3">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</th>
                                <th class="py-3">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                <th class="py-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Role)</th>
                                <th class="py-3 text-end">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="user-list-table">
                            <tr><td colspan="4" class="text-center py-5">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="payment-manage" class="section-panel active">
            <h2 class="mb-4"><i class="fa-solid fa-history me-2 text-primary"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
            <div class="admin-card">
                <div class="table-responsive">
                    <table class="table table-dark table-hover m-0">
                        <thead>
                            <tr>
                                <th class="py-3">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th class="py-3">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                                <th class="py-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th class="py-3">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á/Ref</th>
                                <th class="py-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="py-3 text-end">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="all-payment-table">
                            <tr><td colspan="6" class="text-center py-5">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div style="position: fixed; bottom: 30px; right: 30px; display: flex; gap: 10px;">
            <button class="btn btn-outline-danger btn-lg fw-bold shadow-lg" id="reset-config" style="border-radius: 50px; padding: 15px 30px; background: rgba(220, 53, 69, 0.1);">
                <i class="fa-solid fa-rotate-left me-2"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            </button>

            <button class="btn btn-outline-warning btn-lg fw-bold shadow-lg" id="reset-theme-only" style="border-radius: 50px; padding: 15px 30px; background: rgba(255, 193, 7, 0.1);">
                <i class="fa-solid fa-palette me-2"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏µ & ‡∏ò‡∏µ‡∏°
            </button>
            
            <button class="btn btn-primary btn-lg fw-bold shadow-lg" id="save-all-config" style="border-radius: 50px; padding: 15px 40px;">
                <i class="fa-solid fa-floppy-disk me-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
        </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, get, update, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        document.addEventListener('keydown', function(e) {
    // 1. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Ctrl + S (Save Page)
    if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'S' || e.keyCode === 83)) {
        e.preventDefault();
        // showAlert("‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö", "danger"); // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        return false;
    }

    // 2. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô F12 (DevTools)
    if (e.key === 'F12' || e.keyCode === 123) {
        e.preventDefault();
        return false;
    }

    // 3. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Ctrl + Shift + I / J / C (Inspect/Console)
    if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C' || e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) {
        e.preventDefault();
        return false;
    }

    // 4. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Ctrl + U (View Source)
    if ((e.ctrlKey || e.metaKey) && (e.key === 'u' || e.key === 'U' || e.keyCode === 85)) {
        e.preventDefault();
        return false;
    }
}, false);


        const firebaseConfig = {
            apiKey: "AIzaSyAu_tpFJkolV90YBMFwzSUIu8KnusAB8mg",
            authDomain: "verify-hiz.firebaseapp.com",
            databaseURL: "https://verify-hiz-default-rtdb.firebaseio.com",
            projectId: "verify-hiz",
            storageBucket: "verify-hiz.firebasestorage.app",
            messagingSenderId: "1001871666471",
            appId: "1:1001871666471:web:daea600bd157f907634d02"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Toast ---
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 2000,
            timerProgressBar: true,
            background: '#1a1d21',
            color: '#fff'
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà ‡∏î‡∏∂‡∏á URL ‡∏à‡∏≤‡∏Å Database ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
        const sendDiscordLog = async (title, message, color = 5814783) => {
            try {
                // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡πâ‡∏≠‡∏ô config ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô
                const snapshot = await get(ref(db, 'config'));
                const configData = snapshot.val();
                
                // 2. ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ webhook ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ (‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ô Firebase)
                const webhookUrl = configData.discordWebhook; 

                if (!webhookUrl) {
                    console.error("‚ùå ‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ discordWebhook ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÉ‡∏ô Firebase");
                    return;
                }

                // 3. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Discord
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        embeds: [{
                            title: title,
                            description: message,
                            color: color,
                            timestamp: new Date().toISOString()
                        }]
                    })
                });
                console.log("‚úÖ ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            } catch (err) { 
                console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err); 
            }
        };

        const notifyDiscord = async (title, message, color = 5814783) => {
            const webhookUrl = document.getElementById('conf-discord-webhook').value;
            if (!webhookUrl || !webhookUrl.startsWith('https://discord.com/api/webhooks/')) return;
            try {
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        embeds: [{
                            title: title,
                            description: message,
                            color: color,
                            timestamp: new Date().toISOString(),
                            footer: { text: "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" }
                        }]
                    })
                });
            } catch (err) { console.error("Webhook Error:", err); }
        };

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π Sidebar ---
    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π Sidebar ---
window.showSection = (sectionId) => {
    // 1. ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å Section ‡∏Å‡πà‡∏≠‡∏ô
    document.querySelectorAll('.section-panel').forEach(panel => {
        panel.style.display = 'none';
        panel.classList.remove('active');
    });

    // 2. ‡πÄ‡∏≠‡∏≤ class active ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô Sidebar
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
    });

    // 3. ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Section ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    const activePanel = document.getElementById(sectionId);
    if (activePanel) {
        activePanel.style.display = 'block';
        setTimeout(() => activePanel.classList.add('active'), 10); // ‡πÄ‡∏û‡∏¥‡πà‡∏° delay ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Animation ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    }

    // 4. ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å
    // ‡πÉ‡∏ä‡πâ‡∏´‡∏≤ element ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏≤‡∏à‡∏≤‡∏Å onclick
    const clickedLink = event ? event.currentTarget : null;
    if (clickedLink && clickedLink.classList) {
        clickedLink.classList.add('active');
    } else {
        // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î (‡πÄ‡∏ä‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å) ‡πÉ‡∏´‡πâ‡∏´‡∏≤ element ‡∏ó‡∏µ‡πà‡∏°‡∏µ onclick ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö sectionId
        const links = document.querySelectorAll('.nav-link');
        links.forEach(link => {
            if (link.getAttribute('onclick')?.includes(sectionId)) {
                link.classList.add('active');
            }
        });
    }
};

            // --- üîÑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ---
           // --- üîÑ 1. ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á) ---
            document.getElementById('reset-config').onclick = () => {
                Swal.fire({
                    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?',
                    text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á!',
                    background: '#1a1d21',
                    color: '#fff'
                }).then((result) => {
                    if (result.isConfirmed) {
                        const allDefaults = {
                            siteName: "NAME",
                            accentText: "GAMING SOLUTION",
                            siteDesc: "‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î...",
                            themeColor: "#00d2ff", 
                            bgColor: "#06070a",    
                            textColor: "#ffffff",
                            stat1Value: "0",
                            stat2Value: "0"
                        };
                        update(ref(db, 'config'), allDefaults).then(async () => { // ‡πÄ‡∏û‡∏¥‡πà‡∏° async ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
                            await sendDiscordLog("‚ö†Ô∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö", "‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", 15158332);
                            Swal.fire({ icon: 'success', title: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', background: '#1a1d21', color: '#fff' });
                        });
                    }
                });
            };

            // --- üé® 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞ "‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏ò‡∏µ‡∏°" (‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) ---
            document.getElementById('reset-theme-only').onclick = () => {
                Swal.fire({
                    title: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏ò‡∏µ‡∏°?',
                    text: "‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#ffc107',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏µ‡πÄ‡∏•‡∏¢!',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                    background: '#1a1d21',
                    color: '#fff'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // ‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                        const themeDefaults = {
                            themeColor: "#00d2ff", 
                            bgColor: "#06070a",    
                            textColor: "#ffffff"
                        };

                        update(ref(db, 'config'), themeDefaults).then(() => {
                            sendDiscordLog("üé® ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ò‡∏µ‡∏°", "‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏ò‡∏µ‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô", 15844367);
                            Swal.fire({
                                icon: 'success',
                                title: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                                text: '‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß',
                                background: '#1a1d21',
                                color: '#fff',
                                timer: 1500,
                                showConfirmButton: false
                            });
                        }).catch((err) => {
                            Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: err.message });
                        });
                    }
                });
            };

    // --- üì• ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà) ---
    onValue(ref(db, 'config'), (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.getElementById('conf-sitename').value = data.siteName || '';
            document.getElementById('conf-sitedesc').value = data.siteDesc || '';
            document.getElementById('conf-color').value = data.themeColor || '#00d2ff';
            document.getElementById('conf-bg-color').value = data.bgColor || '#06070a'; // ‡∏î‡∏∂‡∏á‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
            document.getElementById('conf-text-color').value = data.textColor || '#ffffff'; // ‡∏î‡∏∂‡∏á‡∏™‡∏µ‡∏ü‡∏≠‡∏ô‡∏ï‡πå
            document.getElementById('conf-discord-link').value = data.discordLink || '';
            document.getElementById('conf-discord-webhook').value = data.discordWebhook || '';
            document.getElementById('conf-user-webhook').value = data.userWebhook || ''; 
            document.getElementById('conf-accenttext').value = data.accentText || 'GAMING SOLUTION';
            document.getElementById('conf-stat1-value').value = data.stat1Value || '0';
            document.getElementById('conf-stat2-value').value = data.stat2Value || '0';
        }
    });

 // --- üíæ ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á (Save All) ---
document.getElementById('save-all-config').onclick = async () => {
    const updates = {
        siteName: document.getElementById('conf-sitename').value,
        accentText: document.getElementById('conf-accenttext').value,
        siteDesc: document.getElementById('conf-sitedesc').value,
        themeColor: document.getElementById('conf-color').value,
        bgColor: document.getElementById('conf-bg-color').value,
        textColor: document.getElementById('conf-text-color').value,
        discordLink: document.getElementById('conf-discord-link').value,
        discordWebhook: document.getElementById('conf-discord-webhook').value,
        userWebhook: document.getElementById('conf-user-webhook').value,
        stat1Value: document.getElementById('conf-stat1-value').value,
        stat2Value: document.getElementById('conf-stat2-value').value,
    };

    try {
        // 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏•‡∏á Firebase
        await update(ref(db, 'config'), updates);

        // 2. ‡∏î‡∏∂‡∏á Webhook URL
        const snapshot = await get(ref(db, 'config/discordWebhook'));
        let webhookUrl = snapshot.val();

        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏Ñ‡πà‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ /api/webhooks/ ‡∏Å‡πá‡∏û‡∏≠
        if (webhookUrl && webhookUrl.includes('/api/webhooks/')) {
            
            // 3. ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            await fetch(webhookUrl, {
                method: 'POST',
                // ‡∏•‡∏ö headers ‡∏≠‡∏≠‡∏Å‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ no-cors ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏õ‡∏Å‡∏ï‡∏¥
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    embeds: [{
                        title: "üõ†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤",
                        description: "‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
                        color: 3066993,
                        timestamp: new Date().toISOString()
                    }]
                })
            });
        }

        Swal.fire({
            icon: 'success',
            title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
            text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
            background: '#1a1d21',
            color: '#fff',
            timer: 1500,
            showConfirmButton: false
        });

    } catch (err) {
        console.error(err);
        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: err.message, background: '#1a1d21', color: '#fff' });
    }
};

// --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏ö‡∏ö Real-time Search ---
let allUsers = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Filter

const loadUsers = () => {
    const usersRef = ref(db, 'users');
    onValue(usersRef, (snapshot) => {
        allUsers = snapshot.val() || {};
        renderUserTable(allUsers); // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    });
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
const renderUserTable = (usersData) => {
    const tableBody = document.getElementById('user-list-table');
    if (!tableBody) return;
    tableBody.innerHTML = '';

    const uids = Object.keys(usersData);
    if (uids.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</td></tr>';
        return;
    }

    uids.forEach(uid => {
        const user = usersData[uid];
        
        // 1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ Badge
        const username = user.username || (user.email ? user.email.split('@')[0] : 'Unknown');
        const roleBadge = user.role === 'admin' ? 
            '<span class="badge bg-danger shadow-sm">Admin</span>' : 
            '<span class="badge bg-secondary opacity-75">User</span>';
        
        const btnText = user.role === 'admin' ? '‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô User' : '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin';
        const btnClass = user.role === 'admin' ? 'btn-outline-warning' : 'btn-outline-info';

        // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô tr ‡πÅ‡∏•‡∏∞ row ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
        const row = `
            <tr>
                <td class="align-middle fw-bold text-info">${username}</td>
                <td class="align-middle text-white-50 small">${user.email || '-'}</td>
                <td class="align-middle">${roleBadge}</td>
                <td class="text-end">
                    <button class="btn btn-sm ${btnClass} me-2 px-3" onclick="toggleAdminRole('${uid}', '${user.role || 'user'}')">
                        <i class="fa-solid fa-user-shield me-1"></i> ${btnText}
                    </button>
                    
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteUser('${uid}', '${username}')">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </td>
            </tr>
        `;

        // 3. ‡πÅ‡∏ó‡∏£‡∏Å‡πÅ‡∏ñ‡∏ß‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        tableBody.insertAdjacentHTML('beforeend', row);
    });
};

// --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (Search Filter) ---
document.getElementById('user-search-input').addEventListener('input', (e) => {
    const keyword = e.target.value.toLowerCase();
    const filteredUsers = {};

    Object.keys(allUsers).forEach(uid => {
        const user = allUsers[uid];
        const username = (user.username || (user.email ? user.email.split('@')[0] : '')).toLowerCase();
        const email = (user.email || '').toLowerCase();

        if (username.includes(keyword) || email.includes(keyword)) {
            filteredUsers[uid] = user;
        }
    });

    renderUserTable(filteredUsers);
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏® (Export ‡πÉ‡∏´‡πâ HTML ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ)
window.toggleAdminRole = (uid, currentRole) => {
    const newRole = currentRole === 'admin' ? 'user' : 'admin';
    
    Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå?',
        text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô ${newRole.toUpperCase()} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        confirmButtonColor: '#00d2ff',
        background: '#1a1d21',
        color: '#fff'
    }).then((result) => {
        if (result.isConfirmed) {
            update(ref(db, `users/${uid}`), { role: newRole })
                .then(() => {
                    Swal.fire({ icon: 'success', title: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', background: '#1a1d21', color: '#fff', timer: 1000, showConfirmButton: false });
                })
                .catch(err => {
                    console.error(err);
                    Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏î‡πâ', 'error');
                });
        }
    });
};

window.deleteUser = (uid, username) => {
    Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å?',
        text: `‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏•‡∏ö "${username}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£!`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        background: '#1a1d21',
        color: '#fff'
    }).then((result) => {
        if (result.isConfirmed) {
            remove(ref(db, `users/${uid}`)) // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firebase
                .then(() => {
                    Swal.fire({ icon: 'success', title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', background: '#1a1d21', color: '#fff', timer: 1000, showConfirmButton: false });
                });
        }
    });
};
// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
loadUsers();

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
const getStatusBadge = (status) => {
    switch(status) {
        case 'pending': return '<span class="badge bg-warning text-dark"><i class="fa-solid fa-clock me-1"></i> ‡∏£‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</span>';
        case 'success': return '<span class="badge bg-success"><i class="fa-solid fa-check-circle me-1"></i> ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß</span>';
        case 'rejected': return '<span class="badge bg-danger">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>';
        default: return '<span class="badge bg-secondary">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span>';
    }
};

const loadAllPayments = () => {
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å pending_payments
    onValue(ref(db, 'pending_payments'), (pendingSnap) => {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å topup_history
        onValue(ref(db, 'topup_history'), (historySnap) => {
            const tableBody = document.getElementById('all-payment-table');
            if (!tableBody) return;
            
            let combinedData = [];

            // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            const pendingData = pendingSnap.val();
            if (pendingData) {
                Object.keys(pendingData).forEach(id => {
                    combinedData.push({ id, ...pendingData[id], type: 'Manual' });
                });
            }

            // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
            const historyData = historySnap.val();
            if (historyData) {
                Object.keys(historyData).forEach(id => {
                    // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô history ‡πÑ‡∏°‡πà‡∏°‡∏µ status ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô success
                    combinedData.push({ id, ...historyData[id], status: historyData[id].status || 'success' });
                });
            }

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Date ISO)
            combinedData.sort((a, b) => new Date(b.date) - new Date(a.date));

            tableBody.innerHTML = '';
            if (combinedData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</td></tr>';
                return;
            }

            combinedData.forEach(item => {
                const dateStr = new Date(item.date).toLocaleString('th-TH');
                const row = `
                    <tr>
                        <td class="align-middle small">${dateStr}</td>
                        <td class="align-middle">${item.email || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                        <td class="align-middle text-info fw-bold">‡∏ø${item.amount}</td>
                        <td class="align-middle small text-white-50">
                            ${item.type || 'Auto'}<br>
                            <span class="text-secondary">${item.refNo || item.id}</span>
                        </td>
                        <td class="align-middle">${getStatusBadge(item.status)}</td>
                        <td class="text-end">
                            ${item.status === 'pending' ? `
                                <button class="btn btn-sm btn-success me-1" onclick="approvePayment('${item.id}', '${item.uid}', ${item.amount}, '${item.email}')">
                                    ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="rejectPayment('${item.id}')">
                                    <i class="fa-solid fa-xmark"></i>
                                </button>
                            ` : `
                                <span class="text-white-50 small">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
                            `}
                        </td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', row);
            });
        });
    });
};

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô approvePayment ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ history ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
window.approvePayment = async (payId, uid, amount, email) => {
    const result = await Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?',
        text: `‡πÄ‡∏á‡∏¥‡∏ô ‡∏ø${amount} ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á ${email}`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#198754'
    });

    if (result.isConfirmed) {
        try {
            // 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô
            const userRef = ref(db, `users/${uid}/credits`);
            const snap = await get(userRef);
            const current = snap.val() || 0;
            await set(userRef, current + amount);

            // 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤ History (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Success)
            await set(ref(db, `topup_history/${payId}`), {
                uid, email, amount, date: new Date().toISOString(), status: 'success', type: 'Manual'
            });

            // 3. ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Pending
            await remove(ref(db, `pending_payments/${payId}`));

            Toast.fire({ icon: 'success', title: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' });
        } catch (err) {
            Swal.fire('Error', err.message, 'error');
        }
    }
};

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
loadAllPayments();

    </script>
</body>
</html>
